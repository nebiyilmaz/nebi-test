version: '3'
services:

  dft-application-api-platform-db:
    container_name: dft-application-api-platform-db
    image: mysql/mysql-server:5.7
    environment:
     - "MYSQL_DATABASE=platform"
     - "MYSQL_ROOT_PASSWORD=divido"
     - "MYSQL_ROOT_HOST=%"
    ports:
     - "33061:3306"

  dft-application-api-platform-flyway:
      container_name: dft-application-api-platform-flyway
      build: ../docker/flyway
      environment:
       - "CONFIG_MYSQL_HOST=mysql"
       - "CONFIG_MYSQL_PORT=3306"
       - "CONFIG_MYSQL_USERNAME=root"
       - "CONFIG_MYSQL_PASSWORD=divido"
       - "CONFIG_MYSQL_DATABASE=platform"
      volumes:
       - "./platform_db_subset/migrations:/flyway/sql:ro"
      links:
       - "dft-application-api-platform-db:mysql"

networks:
  default:
    external:
      name: dft-application-api-net